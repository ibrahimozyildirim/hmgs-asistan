<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HMGS Asistan</title>
    
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiSE1HUyBBc2lzdGFuIiwic2hvcnRfbmFtZSI6IkhNR1MiLCJzdGFydF91cmwiOiIuLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiMxZTI5M2IiLCJ0aGVtZV9jb2xvciI6IiM0ZjQ2ZTUiLCJpY29ucyI6W3sic3JjIjoiaHR0cHM6Ly91cGxvYWQud2lraW1lZGlhLm9yZy93aWtpcGVkaWEvY29tbW9ucy90aHVtYi81LzU1L1NjYWxlX29mX2p1c3RpY2VfMi5zdmcvMTIwMHB4LVNjYWxlX29mX2p1c3RpY2VfMi5zdmcucG5nIiwic2l6ZXMiOiIxOTJ4MTkyIiwidHlwZSI6ImltYWdlL3BuZyJ9XX0=">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Cropper.js -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>

    <!-- React ve ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        body { -webkit-tap-highlight-color: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .zoom-image { transition: transform 0.2s ease-out; }
        .cropper-view-box, .cropper-face { border-radius: 4px; }
        .cropper-modal { opacity: 0.8; background-color: #000; }
        .cropper-container { touch-action: none; }
    </style>
</head>
<body class="bg-gray-100 text-gray-900 transition-colors duration-300">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Ä°KONLAR ---
        const Icon = ({ path, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{path}</svg>
        );

        const Icons = {
            Camera: (props) => <Icon {...props} path={<><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></>} />,
            BookOpen: (props) => <Icon {...props} path={<><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></>} />,
            Moon: (props) => <Icon {...props} path={<path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/>} />,
            Sun: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></>} />,
            ChevronDown: (props) => <Icon {...props} path={<path d="m6 9 6 6 6-6"/>} />,
            ChevronUp: (props) => <Icon {...props} path={<path d="m18 15-6-6-6 6"/>} />,
            ChevronLeft: (props) => <Icon {...props} path={<path d="m15 18-6-6 6-6"/>} />,
            ChevronRight: (props) => <Icon {...props} path={<path d="m9 18 6-6-6-6"/>} />,
            Save: (props) => <Icon {...props} path={<><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></>} />,
            Trash2: (props) => <Icon {...props} path={<><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></>} />,
            ArrowLeft: (props) => <Icon {...props} path={<><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></>} />,
            Plus: (props) => <Icon {...props} path={<><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></>} />,
            X: (props) => <Icon {...props} path={<><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></>} />,
            ZoomIn: (props) => <Icon {...props} path={<><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="11" y1="8" x2="11" y2="14"/><line x1="8" y1="11" x2="14" y2="11"/></>} />,
            ZoomOut: (props) => <Icon {...props} path={<><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="8" y1="11" x2="14" y2="11"/></>} />,
            Image: (props) => <Icon {...props} path={<><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></>} />,
            RotateCw: (props) => <Icon {...props} path={<><path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8" /><path d="M21 3v5h-5" /></>} />,
            Check: (props) => <Icon {...props} path={<polyline points="20 6 9 17 4 12" />} />,
            RotateCcw: (props) => <Icon {...props} path={<><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0 6.74 2.74L3 8" /><path d="M3 3v5h5" /></>} />,
            Settings: (props) => <Icon {...props} path={<><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></>} />,
            Cloud: (props) => <Icon {...props} path={<path d="M17.5 19c0-1.7-1.3-3-3-3h-1.1c-.1-2.9-2.4-5.1-5.3-5.1-2.1 0-4 1.2-4.9 3.1-.2 0-.4 0-.6 0-2.5 0-4.5 2-4.5 4.5S2.5 23 5 23h12.5c2.5 0 4.5-2 4.5-4.5z"/>} />,
            CloudOff: (props) => <Icon {...props} path={<><path d="M22.61 16.95A5 5 0 0 0 18 10h-1.26a8 8 0 0 0-7.05-6M5 5a8 8 0 0 0 4 7h1.8a5 5 0 0 0 4 10h2.17M2 2l20 20"/></>} />,
            HelpCircle: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></>} />,
        };

        const SUBJECTS = [
            "Anayasa Hukuku", "Ä°dare Hukuku", "Ä°dari YargÄ±lama Hukuku", "Ceza Hukuku (Genel/Ã–zel)",
            "Ceza Muhakemesi Hukuku", "Medeni Hukuk", "BorÃ§lar Hukuku", "Ticaret Hukuku",
            "Ä°cra ve Ä°flas Hukuku", "Ä°ÅŸ Hukuku", "Vergi Hukuku", "TÃ¼rk Hukuk Tarihi", "Genel Hukuk Bilgisi"
        ];

        // --- GÃ–RSEL DÃœZENLEYÄ°CÄ° ---
        function ImageEditor({ src, onSave, onCancel, title }) {
            const imageRef = useRef(null);
            const cropperRef = useRef(null);
            const [isReady, setIsReady] = useState(false);

            useEffect(() => {
                return () => { if (cropperRef.current) cropperRef.current.destroy(); };
            }, []);

            const handleImageLoad = () => {
                const imageElement = imageRef.current;
                if (imageElement && window.Cropper) {
                    if (cropperRef.current) cropperRef.current.destroy();
                    const cropper = new window.Cropper(imageElement, {
                        viewMode: 1, dragMode: 'move', autoCropArea: 0.9, restore: false,
                        guides: true, center: true, highlight: false, cropBoxMovable: true,
                        cropBoxResizable: true, toggleDragModeOnDblclick: false, background: false,
                        minContainerWidth: 300, minContainerHeight: 300,
                    });
                    cropperRef.current = cropper;
                    setIsReady(true);
                }
            };

            const handleRotateRight = () => cropperRef.current?.rotate(90);
            const handleRotateLeft = () => cropperRef.current?.rotate(-90);
            const handleReset = () => cropperRef.current?.reset();
            
            const handleSave = () => {
                if (cropperRef.current) {
                    let quality = 0.9;
                    let width = 2560; 
                    let canvas = cropperRef.current.getCroppedCanvas({ maxWidth: width, maxHeight: width, fillColor: '#fff' });
                    let dataUrl = canvas.toDataURL('image/jpeg', quality);

                    while (dataUrl.length > 800000 && quality > 0.6) {
                        quality -= 0.1;
                        dataUrl = canvas.toDataURL('image/jpeg', quality);
                    }
                    while (dataUrl.length > 800000 && width > 1200) {
                        width -= 400;
                        canvas = cropperRef.current.getCroppedCanvas({ maxWidth: width, maxHeight: width, fillColor: '#fff' });
                        dataUrl = canvas.toDataURL('image/jpeg', quality);
                    }
                    onSave(dataUrl);
                }
            };

            return (
                <div className="fixed inset-0 z-[60] bg-black flex flex-col animate-fade-in">
                    <div className="flex justify-between items-center p-4 bg-black/80 text-white backdrop-blur-sm z-10 border-b border-white/10">
                        <button onClick={onCancel} className="text-sm font-medium hover:opacity-70 px-2 py-1">Ä°ptal</button>
                        <span className="font-bold">{title || "FotoÄŸrafÄ± DÃ¼zenle"}</span>
                        <button onClick={handleSave} className="text-indigo-400 font-bold hover:text-indigo-300 flex items-center gap-1 px-2 py-1"><Icons.Check size={20} /> Kaydet</button>
                    </div>
                    <div className="flex-1 overflow-hidden bg-[#1a1a1a] relative flex items-center justify-center">
                         <img ref={imageRef} src={src} alt="Edit" onLoad={handleImageLoad} style={{ maxWidth: '100%', maxHeight: '100%', display: 'block', opacity: isReady ? 1 : 0 }} />
                         {!isReady && <div className="absolute text-white animate-pulse">YÃ¼kleniyor...</div>}
                    </div>
                    <div className="bg-black/80 p-6 flex justify-around items-center text-white pb-8 border-t border-white/10">
                        <button onClick={handleRotateLeft} className="flex flex-col items-center gap-2 hover:text-indigo-400"><div className="p-3 bg-white/10 rounded-full"><Icons.RotateCcw size={24} /></div><span className="text-xs">Sola</span></button>
                        <button onClick={handleReset} className="flex flex-col items-center gap-2 hover:text-red-400"><div className="p-3 bg-white/10 rounded-full"><Icons.X size={24} /></div><span className="text-xs">SÄ±fÄ±rla</span></button>
                        <button onClick={handleRotateRight} className="flex flex-col items-center gap-2 hover:text-indigo-400"><div className="p-3 bg-white/10 rounded-full"><Icons.RotateCw size={24} /></div><span className="text-xs">SaÄŸa</span></button>
                    </div>
                </div>
            );
        }

        // --- GALERÄ° GÃ–RÃœNTÃœLEYÄ°CÄ° ---
        function ImageViewer({ images, initialIndex, onClose }) {
            const [currentIndex, setCurrentIndex] = useState(initialIndex);
            const [scale, setScale] = useState(1);
            const touchStartX = useRef(0);
            const touchEndX = useRef(0);
            
            const handleZoomIn = (e) => { e.stopPropagation(); setScale(prev => Math.min(prev + 0.5, 4)); };
            const handleZoomOut = (e) => { e.stopPropagation(); setScale(prev => Math.max(prev - 0.5, 1)); };
            const handleNext = (e) => { if(e) e.stopPropagation(); if (currentIndex < images.length - 1) { setCurrentIndex(currentIndex + 1); setScale(1); } };
            const handlePrev = (e) => { if(e) e.stopPropagation(); if (currentIndex > 0) { setCurrentIndex(currentIndex - 1); setScale(1); } };
            const handleTouchStart = (e) => { touchStartX.current = e.changedTouches[0].screenX; };
            const handleTouchEnd = (e) => { touchEndX.current = e.changedTouches[0].screenX; if (scale > 1) return; if(touchStartX.current - touchEndX.current > 50) handleNext(); else if(touchStartX.current - touchEndX.current < -50) handlePrev(); };

            return (
                <div className="fixed inset-0 z-50 bg-black/95 flex flex-col items-center justify-center animate-fade-in" onClick={onClose} onTouchStart={handleTouchStart} onTouchEnd={handleTouchEnd}>
                    <div className="absolute top-4 right-4 z-50 flex gap-4">
                        <button onClick={handleZoomOut} className="p-2 bg-white/10 rounded-full text-white"><Icons.ZoomOut size={24} /></button>
                        <button onClick={handleZoomIn} className="p-2 bg-white/10 rounded-full text-white"><Icons.ZoomIn size={24} /></button>
                        <button onClick={onClose} className="p-2 bg-red-500/80 rounded-full text-white"><Icons.X size={24} /></button>
                    </div>
                    {currentIndex > 0 && <button onClick={handlePrev} className="absolute left-4 top-1/2 -translate-y-1/2 p-3 bg-white/10 rounded-full text-white hidden md:block"><Icons.ChevronLeft size={32} /></button>}
                    {currentIndex < images.length - 1 && <button onClick={handleNext} className="absolute right-4 top-1/2 -translate-y-1/2 p-3 bg-white/10 rounded-full text-white hidden md:block"><Icons.ChevronRight size={32} /></button>}
                    <div className="w-full h-full overflow-hidden flex items-center justify-center p-2" onClick={(e) => e.stopPropagation()}>
                        <img src={images[currentIndex]} alt="Slide" className="zoom-image max-w-full max-h-full object-contain transition-transform duration-200" style={{ transform: `scale(${scale})` }} />
                    </div>
                    <div className="absolute bottom-6 flex gap-2">{images.map((_, idx) => <div key={idx} className={`h-2 w-2 rounded-full transition-all ${idx === currentIndex ? 'bg-white w-4' : 'bg-white/30'}`} />)}</div>
                </div>
            );
        }

        // --- AYARLAR MODALI ---
        function SettingsModal({ isOpen, onClose, firebaseConfig, onSaveConfig }) {
            const [configInput, setConfigInput] = useState(firebaseConfig ? JSON.stringify(firebaseConfig, null, 2) : '');
            const [showHelp, setShowHelp] = useState(false);

            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4 animate-fade-in" onClick={onClose}>
                    <div className="bg-white dark:bg-slate-800 rounded-xl p-6 w-full max-w-md shadow-2xl max-h-[90vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
                        <div className="flex justify-between items-center mb-4">
                            <h2 className="text-xl font-bold flex items-center gap-2"><Icons.Settings size={24} /> Ayarlar</h2>
                            <button onClick={onClose}><Icons.X size={24} /></button>
                        </div>
                        <div className="space-y-4">
                            <h3 className="font-semibold mb-2 flex items-center gap-2"><Icons.Cloud size={20} className="text-blue-500" /> Bulut BaÄŸlantÄ±sÄ±</h3>
                            <p className="text-sm opacity-70 mb-2">CihazlarÄ±nÄ± eÅŸitlemek iÃ§in Firebase kodunu yapÄ±ÅŸtÄ±r.</p>
                            <button onClick={() => setShowHelp(!showHelp)} className="flex items-center gap-1 text-indigo-500 text-xs font-bold hover:underline mb-3"><Icons.HelpCircle size={14} /> {showHelp ? "Gizle" : "NasÄ±l AlÄ±nÄ±r?"}</button>
                            {showHelp && <div className="bg-indigo-50 dark:bg-slate-700/50 p-4 rounded-lg text-xs space-y-2 border border-indigo-100 dark:border-slate-600"><p>1. console.firebase.google.com -> Projenize girin.</p><p>2. Ayarlar (DiÅŸli Ã‡ark) -> Project Settings.</p><p>3. AÅŸaÄŸÄ±da "Your apps" kÄ±smÄ±ndaki <code>const firebaseConfig</code> kodunu kopyalayÄ±n.</p><p>4. <strong>Ã–NEMLÄ°:</strong> VeritabanÄ± "Rules" kÄ±smÄ±nda <code>allow read, write: if true;</code> olduÄŸundan emin olun.</p></div>}
                            <textarea className="w-full h-32 p-3 text-xs font-mono border rounded bg-gray-50 dark:bg-slate-900 dark:border-slate-700 outline-none" placeholder='{ "apiKey": "...", ... }' value={configInput} onChange={(e) => setConfigInput(e.target.value)} />
                            <button onClick={() => onSaveConfig(configInput)} className="w-full py-3 bg-indigo-600 text-white rounded-lg font-bold hover:bg-indigo-700">Kaydet ve BaÄŸlan</button>
                        </div>
                    </div>
                </div>
            );
        }

        // --- ANA UYGULAMA ---
        function App() {
            const [activeTab, setActiveTab] = useState('home'); 
            const [selectedSubject, setSelectedSubject] = useState(null);
            const [selectedType, setSelectedType] = useState('note'); 
            const [items, setItems] = useState([]);
            const [darkMode, setDarkMode] = useState(true);
            const [loading, setLoading] = useState(false);
            const [processingText, setProcessingText] = useState('');
            
            const [firebaseConfig, setFirebaseConfig] = useState(null);
            const [isCloudConnected, setIsCloudConnected] = useState(false);
            const [showSettings, setShowSettings] = useState(false);
            
            const [inputImages, setInputImages] = useState([null, null]); 
            const [inputText, setInputText] = useState('');
            const [inputAnswer, setInputAnswer] = useState(''); 
            
            const [viewerData, setViewerData] = useState(null);
            const [editingImage, setEditingImage] = useState(null); 
            const [editingIndex, setEditingIndex] = useState(null); 
            const fileInputRef = useRef(null);

            useEffect(() => {
                const savedConfig = localStorage.getItem('hmgs_firebase_config');
                if (savedConfig) {
                    try { const config = JSON.parse(savedConfig); setFirebaseConfig(config); connectToFirebase(config); } catch(e) { console.error(e); }
                } else {
                    const savedLocal = localStorage.getItem('hmgs_items');
                    if(savedLocal) setItems(JSON.parse(savedLocal));
                }
            }, []);

            const connectToFirebase = (config) => {
                try {
                    if (!firebase.apps.length) firebase.initializeApp(config);
                    const db = firebase.firestore();
                    setIsCloudConnected(true);
                    db.collection('items').orderBy('date', 'desc').onSnapshot((snapshot) => {
                        const cloudItems = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        setItems(cloudItems);
                    }, (err) => {
                        console.error("Sync hatasÄ±:", err);
                        setIsCloudConnected(false);
                    });
                } catch (error) {
                    setIsCloudConnected(false);
                }
            };

            const handleSaveConfig = (configStr) => {
                try { const config = JSON.parse(configStr); setFirebaseConfig(config); localStorage.setItem('hmgs_firebase_config', JSON.stringify(config)); connectToFirebase(config); setShowSettings(false); alert("BaÄŸlandÄ±!"); } catch(e) { alert("Config hatalÄ±"); }
            };

            const toggleDarkMode = () => setDarkMode(!darkMode);
            const handleFileSelect = (e, index) => { const file = e.target.files[0]; if (!file) return; const reader = new FileReader(); reader.onload = (event) => { setEditingImage(event.target.result); setEditingIndex(index); e.target.value = ''; }; reader.readAsDataURL(file); };
            
            const handleEditorSave = (croppedImage) => {
                const newImages = [...inputImages]; newImages[editingIndex] = croppedImage; setInputImages(newImages);
                if (editingIndex === 0 && window.confirm("ðŸ“¸ Bu fotoÄŸrafta cevap/Ã§Ã¶zÃ¼m de var mÄ±?\n\n'Tamam' derseniz aynÄ± fotoÄŸraf Ã¼zerinden cevabÄ± da kÄ±rpabilirsiniz.")) { setEditingIndex(1); return; }
                setEditingImage(null); setEditingIndex(null);
            };

            const handleSave = async () => {
                if (!selectedSubject) { alert("Ders seÃ§in."); return; }
                if (!inputText && !inputImages[0] && !inputImages[1]) { alert("Ä°Ã§erik giriniz."); return; }
                setLoading(true); setProcessingText('Kaydediliyor...');
                
                const newItem = { subject: selectedSubject, type: selectedType, text: inputText, answer: inputAnswer, images: inputImages.filter(img => img !== null), date: new Date().toLocaleDateString('tr-TR') };
                
                try {
                    if (isCloudConnected) {
                        await firebase.firestore().collection('items').add(newItem);
                    } else {
                        const updated = [newItem, ...items]; setItems(updated); localStorage.setItem('hmgs_items', JSON.stringify(updated));
                    }
                    setInputText(''); setInputAnswer(''); setInputImages([null, null]); setActiveTab('home');
                } catch (error) { alert("Hata: " + error.message); } finally { setLoading(false); }
            };

            const handleDelete = async (id) => {
                if(!window.confirm("Bu kaydÄ± silmek istediÄŸinize emin misiniz?")) return;
                try {
                    if (isCloudConnected) {
                        await firebase.firestore().collection('items').doc(id).delete();
                    } else {
                        const filtered = items.filter(item => item.id !== id);
                        setItems(filtered);
                        localStorage.setItem('hmgs_items', JSON.stringify(filtered));
                    }
                } catch (err) {
                    alert("Silinemedi! Hata: " + err.message + "\n\nÄ°pucu: Firebase Konsolunda 'Rules' kÄ±smÄ±nÄ±n herkese aÃ§Ä±k (public) olduÄŸundan emin olun.");
                }
            };

            const getFilteredItems = (subject, type) => items.filter(item => item.subject === subject && item.type === type);

            if (loading) return <div className={`min-h-screen flex flex-col items-center justify-center ${darkMode?'bg-slate-900 text-white':'bg-gray-100'}`}><div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500 mb-4"></div>{processingText}</div>;

            return (
                <div className={`min-h-screen transition-colors duration-300 ${darkMode ? 'bg-slate-900 text-slate-100' : 'bg-gray-50 text-gray-900'} font-sans pb-24`}>
                    {viewerData && <ImageViewer images={viewerData.images} initialIndex={viewerData.index} onClose={() => setViewerData(null)} />}
                    {editingImage && <ImageEditor key={editingIndex} src={editingImage} title={editingIndex === 0 ? "1. AdÄ±m: Soruyu KÄ±rp" : "2. AdÄ±m: CevabÄ± KÄ±rp"} onSave={handleEditorSave} onCancel={() => setEditingImage(null)} />}
                    <SettingsModal isOpen={showSettings} onClose={() => setShowSettings(false)} firebaseConfig={firebaseConfig} onSaveConfig={handleSaveConfig} />

                    <div className={`p-4 shadow-md sticky top-0 z-40 flex justify-between items-center ${darkMode ? 'bg-slate-800' : 'bg-white'}`}>
                        <div className="flex items-center gap-2">
                            {activeTab !== 'home' && <button onClick={() => setActiveTab('home')}><Icons.ArrowLeft size={24} /></button>}
                            <h1 className="text-xl font-bold bg-gradient-to-r from-indigo-500 to-purple-500 bg-clip-text text-transparent">HMGS Asistan</h1>
                            {isCloudConnected ? <span className="text-[10px] bg-green-500/20 text-green-500 px-2 py-1 rounded-full animate-pulse">Bulut</span> : <span className="text-[10px] bg-gray-500/20 text-gray-500 px-2 py-1 rounded-full">Yerel</span>}
                        </div>
                        <div className="flex gap-2">
                            <button onClick={() => setShowSettings(true)} className={`p-2 rounded-full ${darkMode ? 'bg-slate-700' : 'bg-gray-200'}`}><Icons.Settings size={20} /></button>
                            <button onClick={toggleDarkMode} className={`p-2 rounded-full ${darkMode ? 'bg-slate-700' : 'bg-gray-200'}`}>{darkMode ? <Icons.Sun size={20} /> : <Icons.Moon size={20} />}</button>
                        </div>
                    </div>

                    <div className="p-4 max-w-md mx-auto">
                        {activeTab === 'home' && (
                            <div className="space-y-4">
                                <div className={`p-6 rounded-2xl bg-gradient-to-br from-indigo-600 to-purple-700 text-white mb-6 shadow-lg`}>
                                    <h2 className="text-2xl font-bold mb-2">HoÅŸ Geldin!</h2>
                                    <p className="opacity-90">{isCloudConnected ? "Bulut senkronizasyonu aktif." : "Yerel moddasÄ±n. Ayarlardan bulutu baÄŸla."}</p>
                                    <div className="mt-4 flex gap-3 text-center">
                                        <div className="flex-1"><span className="block text-2xl font-bold">{items.filter(i => i.type === 'note').length}</span><span className="text-xs opacity-75">Not</span></div>
                                        <div className="flex-1 border-l border-white/20"><span className="block text-2xl font-bold">{items.filter(i => i.type === 'question').length}</span><span className="text-xs opacity-75">Soru</span></div>
                                    </div>
                                </div>
                                <div className="grid grid-cols-2 gap-3">
                                    {SUBJECTS.map(subject => (
                                        <button key={subject} onClick={() => { setSelectedSubject(subject); setActiveTab('list'); }} className={`p-4 rounded-xl shadow-sm border text-left active:scale-95 flex flex-col justify-between h-32 ${darkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-gray-200'}`}>
                                            <span className="font-semibold text-sm line-clamp-2">{subject}</span>
                                            <div className="flex justify-between items-end mt-2"><Icons.BookOpen size={16} className="text-indigo-500" /><span className="text-xs px-2 py-1 rounded-full bg-indigo-500/10 text-indigo-500 font-bold">{items.filter(i => i.subject === subject).length}</span></div>
                                        </button>
                                    ))}
                                </div>
                            </div>
                        )}

                        {activeTab === 'list' && (
                            <div>
                                <h2 className="text-2xl font-bold mb-4 px-2">{selectedSubject}</h2>
                                <div className="flex gap-2 mb-6 p-1 rounded-xl bg-gray-200/20">
                                    {['note', 'question'].map(type => (
                                        <button key={type} onClick={() => setSelectedType(type)} className={`flex-1 py-2 rounded-lg text-sm font-medium transition-all ${selectedType === type ? 'bg-indigo-600 text-white shadow-md' : 'text-gray-500'}`}>{type === 'note' ? 'Notlar' : 'Sorular'}</button>
                                    ))}
                                </div>
                                <div className="space-y-4">
                                    {getFilteredItems(selectedSubject, selectedType).length === 0 ? <div className="text-center py-10 opacity-50"><Icons.BookOpen size={48} className="mx-auto mb-3" /><p>HenÃ¼z iÃ§erik yok.</p></div> : 
                                    getFilteredItems(selectedSubject, selectedType).map(item => (
                                        <div key={item.id} className={`rounded-xl p-4 shadow-sm border ${darkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-gray-200'}`}>
                                            <div className="flex justify-between items-start mb-2"><span className="text-xs font-bold px-2 py-1 rounded bg-indigo-500/10 text-indigo-500 uppercase">{item.subject}</span><button onClick={() => handleDelete(item.id)} className="text-red-400 p-1"><Icons.Trash2 size={16} /></button></div>
                                            {item.text && <p className="mb-3 whitespace-pre-wrap font-medium text-sm">{item.text}</p>}
                                            {(item.images || [item.image]).filter(Boolean).length > 0 && (
                                                <div className="grid grid-cols-2 gap-2 mb-3">
                                                    {(item.images || [item.image]).filter(Boolean).map((src, idx) => (
                                                        <div key={idx} className="relative group"><img src={src} onClick={() => setViewerData({ images: (item.images || [item.image]), index: idx })} className="rounded-lg h-32 w-full object-cover shadow-sm cursor-pointer" /><div className="absolute bottom-0 left-0 right-0 bg-black/50 text-white text-[10px] text-center py-1 rounded-b-lg">{idx === 0 ? 'Soru' : 'Cevap'}</div></div>
                                                    ))}
                                                </div>
                                            )}
                                            {item.type === 'question' && item.answer && <div className={`mt-2 p-3 rounded-lg text-sm ${darkMode ? 'bg-slate-700/50' : 'bg-gray-100'}`}><p className="font-bold text-green-500">{item.answer}</p></div>}
                                            <div className="mt-2 text-right"><span className="text-[10px] opacity-40">{item.date}</span></div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {activeTab === 'add' && (
                            <div className="space-y-5 animate-fade-in">
                                <h2 className="text-xl font-bold">Yeni Ä°Ã§erik Ekle</h2>
                                <div className="grid grid-cols-2 gap-3">
                                    {[0, 1].map(idx => (
                                        <div key={idx} className={`border-2 border-dashed rounded-xl p-4 text-center relative h-40 flex flex-col items-center justify-center overflow-hidden ${darkMode ? 'border-slate-700 bg-slate-800' : 'border-gray-300 bg-white'}`}>
                                            {inputImages[idx] ? (
                                                <><img src={inputImages[idx]} className="absolute inset-0 w-full h-full object-cover opacity-80" /><button onClick={() => {const n=[...inputImages];n[idx]=null;setInputImages(n)}} className="absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 z-20"><Icons.X size={16} /></button><div className="absolute bottom-0 w-full bg-black/50 text-white text-xs py-1">{idx===0?'Soru':'Cevap'}</div></>
                                            ) : (
                                                <><input type="file" accept="image/*" onChange={(e) => handleFileSelect(e, idx)} className="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10" />{idx===0?<Icons.Camera size={24} className="text-indigo-500 mb-2"/>:<Icons.Plus size={24} className="text-gray-500 mb-2"/>}<span className="text-xs font-bold">{idx===0?'Soru FotoÄŸrafÄ±':'Ek FotoÄŸraf'}</span></>
                                            )}
                                        </div>
                                    ))}
                                </div>
                                <div><label className="text-xs font-bold uppercase opacity-60 mb-1 block">Ders</label><select value={selectedSubject || ''} onChange={(e) => setSelectedSubject(e.target.value)} className={`w-full p-3 rounded-lg border outline-none ${darkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-gray-300'}`}><option value="" disabled>Ders SeÃ§iniz</option>{SUBJECTS.map(s => <option key={s} value={s}>{s}</option>)}</select></div>
                                <div className="flex gap-4">{['note', 'question'].map(type => <label key={type} className="flex items-center gap-2 cursor-pointer"><input type="radio" name="type" checked={selectedType === type} onChange={() => setSelectedType(type)} className="w-4 h-4 text-indigo-600" /><span>{type === 'note' ? 'Ders Notu' : 'Soru'}</span></label>)}</div>
                                <div><label className="text-xs font-bold uppercase opacity-60 mb-1 block">Metin / BaÅŸlÄ±k</label><textarea value={inputText} onChange={(e) => setInputText(e.target.value)} rows={2} className={`w-full p-3 rounded-lg border outline-none ${darkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-gray-300'}`} placeholder="Ä°Ã§erik..." /></div>
                                {selectedType === 'question' && <div><label className="text-xs font-bold uppercase opacity-60 mb-1 block">Cevap (YazÄ±lÄ±)</label><textarea value={inputAnswer} onChange={(e) => setInputAnswer(e.target.value)} rows={2} className={`w-full p-3 rounded-lg border outline-none ${darkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-gray-300'}`} placeholder="Cevap..." /></div>}
                                <button onClick={handleSave} className="w-full py-4 rounded-xl bg-indigo-600 text-white font-bold text-lg shadow-lg hover:bg-indigo-700 flex items-center justify-center gap-2"><Icons.Save size={20} /> Kaydet</button>
                            </div>
                        )}
                    </div>

                    {activeTab !== 'add' && <button onClick={() => { setActiveTab('add'); setInputText(''); setInputImages([null, null]); setInputAnswer(''); }} className="fixed bottom-6 right-6 w-14 h-14 bg-indigo-600 text-white rounded-full shadow-2xl flex items-center justify-center hover:bg-indigo-700 active:scale-90 transition-all z-20"><Icons.Plus size={32} /></button>}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
